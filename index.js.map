{"version":3,"file":"index.js","sourceRoot":"","sources":["index.ts"],"names":[],"mappings":"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","sourcesContent":["/**\n * Created by user on 2017/7/12/012.\n */\n\n'use strict';\n\nimport path = require('upath');\nimport fs = require('fs');\nimport ini  = require('ini');\n\n/**\n * get Firefox Data dir\n *\n * @see https://github.com/saadtazi/firefox-profile-js/blob/5c4a98f6e2977a2efc10afaecf1f86d621b7f069/lib/profile_finder.js\n */\nexport function os_appdata(platform: string = process.platform, env: IEnv = process.env)\n{\n\tlet profiledir: string = null;\n\n\tswitch (platform)\n\t{\n\t\tcase 'darwin':\n\t\t\tprofiledir = path.join(env.HOME, 'Library/Application Support/Firefox');\n\t\t\tbreak;\n\t\tcase 'linux':\n\t\t\tprofiledir = path.join(env.HOME, '.mozilla/firefox');\n\t\t\tbreak;\n\t\tcase 'win32':\n\t\tdefault:\n\n\t\t\tif (!env.APPDATA)\n\t\t\t{\n\t\t\t\tenv.APPDATA = path.join(env.HOME || env.USERPROFILE, 'AppData/Roaming');\n\t\t\t}\n\n\t\t\tprofiledir = path.join(env.APPDATA, 'Mozilla/Firefox');\n\t\t\tbreak;\n\t}\n\n\treturn profiledir;\n}\n\n/**\n * parse firefox profile ini\n */\nexport function os_profile_ini(platform: string = process.platform, env: IEnv = process.env)\n{\n\tlet basedir = os_appdata(platform, env);\n\n\tlet profiles = fs.readFileSync(path.join(basedir, 'profiles.ini'));\n\treturn ini.parse(profiles.toString()) as IFirefoxProfilesIni;\n}\n\n/**\n * get profile list from profile.ini\n */\nexport function os_profile_list(platform: string = process.platform, env: IEnv = process.env): IReturnMapList\n{\n\tlet basedir = os_appdata(platform, env);\n\tlet profile = os_profile_ini(platform, env);\n\n\treturn Object.keys(profile)\n\t\t.reduce((a, b) =>\n\t\t{\n\t\t\tlet dir: string = profile[b].Path;\n\n\t\t\tif (/^Profile(\\d+)$/.test(b) && dir)\n\t\t\t{\n\t\t\t\t// some profile has same name, so use dir name\n\t\t\t\tlet name = path.basename(dir);\n\n\t\t\t\tif (profile[b].IsRelative)\n\t\t\t\t{\n\t\t\t\t\tdir = path.join(basedir, dir)\n\t\t\t\t}\n\n\t\t\t\ta[name] = dir;\n\t\t\t}\n\n\t\t\treturn a;\n\t\t}, {} as IReturnMapList)\n\t;\n}\n\n/**\n * get profile list by search profile dir\n *\n */\nexport function os_profile_list2(platform: string = process.platform, env: IEnv = process.env): IReturnMapList\n{\n\tlet basedir = os_appdata(platform, env);\n\n\tbasedir = path.join(basedir, 'Profiles');\n\n\tlet ls = fs.readdirSync(basedir);\n\n\treturn ls.reduce((a, b) =>\n\t{\n\t\tlet dir = path.join(basedir, b);\n\n\t\ttry\n\t\t{\n\t\t\tlet stat = fs.statSync(dir);\n\n\t\t\tif (stat.isDirectory())\n\t\t\t{\n\t\t\t\ta[b] = dir;\n\t\t\t}\n\t\t}\n\t\tcatch (e)\n\t\t{\n\t\t\tif (e.code == 'ENOENT')\n\t\t\t{\n\t\t\t\t//console.error(e);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthrow e;\n\t\t\t}\n\t\t}\n\n\t\treturn a;\n\t}, {} as IReturnMapList);\n}\n\n/**\n * get profile list from PortableApps env\n * only for windows system\n */\nexport function pa_profile_list(env: IEnv = process.env): IReturnMapList\n{\n\t//console.log(env['PAL:PortableAppsBaseDir']);\n\n\tif (env['PAL:PortableAppsBaseDir'])\n\t{\n\t\tlet basedir = path.join(env['PAL:PortableAppsBaseDir'], 'PortableApps');\n\t\tlet ls = fs.readdirSync(basedir);\n\n\t\tif (ls)\n\t\t{\n\t\t\treturn ls.reduce((a, b) =>\n\t\t\t{\n\t\t\t\tlet dir = path.join(basedir, b, 'Data/profile');\n\n\t\t\t\tif (/^Firefox(.*)?Portable/i.test(b))\n\t\t\t\t{\n\t\t\t\t\ttry\n\t\t\t\t\t{\n\t\t\t\t\t\tlet stat = fs.statSync(dir);\n\n\t\t\t\t\t\tif (stat.isDirectory())\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ta[b] = dir;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tcatch (e)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (e.code == 'ENOENT')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t//console.error(e);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthrow e;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn a;\n\t\t\t}, {} as IReturnMapList)\n\t\t}\n\t}\n\n\treturn null;\n}\n\nexport type IEnv = typeof process.env & {\n\tHOME?: string,\n\tUSERPROFILE?: string,\n\t'PAL:PortableAppsBaseDir'?: string,\n}\n\nexport interface IReturnMapList\n{\n\t[k: string]: string,\n}\n\nexport interface IFirefoxProfilesIni\n{\n\tGeneral: {\n\t\tStartWithLastProfile: EnumTrueFalseNumber,\n\t\t[key: string]: any,\n\t},\n\n\t[key: string]: any | IFirefoxProfilesIniItem;\n}\n\nexport interface IFirefoxProfilesIniItem\n{\n\tName: string,\n\tIsRelative: EnumTrueFalseNumber,\n\tPath: string,\n}\n\nexport const enum EnumTrueFalseNumber\n{\n\tFALSE = 0,\n\tTRUE = 1\n}\n\nexport default exports as typeof import('./index');\n"]}